# DDSUViewer

**DDSU666 单相电子式电能表上位机软件**

一个基于 Wails v2 框架开发的现代化桌面应用程序，专为 DDSU666 电能表数据采集和监控而设计。

## 🚀 功能特性

### 📊 实时数据监控
- **电参量实时显示**：电压、电流、功率（有功/无功/视在）、功率因数、频率
- **电能累计显示**：有功总电能读数
- **1秒刷新频率**：确保数据实时性
- **数据有效性检查**：自动过滤异常数据（NaN/Inf）

### 🔌 串口通信
- **自动端口检测**：自动枚举系统可用COM端口
- **灵活参数配置**：波特率、数据位、停止位、校验位可调
- **十六进制从站地址**：支持0x01-0xFF范围设置
- **连接状态监控**：实时显示连接状态和错误信息

### 📡 Modbus RTU协议
- **标准协议实现**：完整的Modbus RTU协议栈
- **CRC16校验**：确保数据传输可靠性
- **智能重试机制**：3次重试，200ms超时
- **IEEE754解析**：正确处理DDSU666特殊字节序

### 🎨 现代化界面
- **响应式设计**：适配不同屏幕尺寸
- **实时数据卡片**：直观的数据展示
- **状态指示器**：清晰的连接和协议状态
- **错误提示系统**：友好的用户反馈

## 🛠️ 技术架构

### 后端技术栈
- **Go 1.23**：高性能系统编程语言
- **Wails v2**：现代化桌面应用框架
- **go.bug.st/serial**：跨平台串口通信库

### 前端技术栈
- **React 18**：现代化前端框架
- **TypeScript**：类型安全的JavaScript
- **Chakra UI**：现代化组件库
- **Vite**：快速构建工具

### 核心模块
```
internal/
├── serial/           # 串口通信模块
├── modbus/           # Modbus RTU协议实现
├── registers/        # 寄存器映射和数据解析
├── poller/           # 数据轮询调度器
├── parser/           # IEEE754浮点数解析
└── service/          # 业务逻辑服务层
```

## 📋 系统要求

### 运行环境
- **操作系统**：Windows 10/11 (x64)
- **硬件接口**：RS485串口或USB转RS485适配器
- **设备支持**：DDSU666系列单相电能表

### 开发环境
- **Go**: 1.23+
- **Node.js**: 16+
- **Wails CLI**: v2.10.2+

## 🚀 快速开始

### 1. 克隆项目
```bash
git clone https://github.com/ChuwuYo/DDSUViewer.git
cd DDSUViewer
```

### 2. 安装依赖
```bash
# 安装Go依赖
go mod tidy

# 安装前端依赖
cd frontend && npm install && cd ..
```

### 3. 开发模式
```bash
wails dev
```

### 4. 构建发布版
```bash
# 基础构建
wails build

# 带版本号构建
wails build -ldflags="-X main.Version=1.0.0"

# 压缩构建
wails build -ldflags="-s -w" -upx
```

## ⚙️ 使用说明

### 1. 硬件连接
1. 将DDSU666电能表通过RS485接口连接到计算机
2. 确认电能表从站地址（默认0x0C，可通过电能表按键设置）
3. 确认通信参数：9600bps, 8N1（DDSU666默认设置）

### 2. 软件配置
1. 启动DDSUViewer应用程序
2. 在右侧配置面板选择正确的COM端口
3. 设置从站地址（十六进制格式，如：0C）
4. 根据需要调整通信参数
5. 点击"打开串口"开始数据采集

### 3. 数据监控
- **实时数据**：左侧面板显示当前电参量数据
- **连接状态**：右上角显示连接状态和协议信息
- **错误处理**：如有通信错误，会在状态面板显示详细信息

## 🔧 故障排除

### 常见问题

**Q: 提示"串口不存在"**
- 检查设备管理器中COM端口是否正常
- 确认USB转RS485驱动已正确安装
- 尝试重新插拔USB设备

**Q: 提示"串口被占用"**
- 关闭其他串口调试工具（如串口助手、Arduino IDE等）
- 检查是否有其他程序占用该端口

**Q: 连接成功但无数据**
- 检查从站地址是否正确（电能表实际地址）
- 确认RS485接线是否正确（A+、B-）
- 检查电能表是否支持Modbus RTU协议

**Q: 数据显示异常**
- 确认电能表型号为DDSU666系列
- 检查通信参数是否匹配（波特率、数据位等）
- 尝试重新连接

## 📊 支持的寄存器

| 参数 | 寄存器地址 | 数据类型 | 单位 |
|------|------------|----------|------|
| 电压 | 0x2000 | IEEE754 | V |
| 电流 | 0x2002 | IEEE754 | A |
| 有功功率 | 0x2004 | IEEE754 | W |
| 无功功率 | 0x2006 | IEEE754 | VAR |
| 视在功率 | 0x2008 | IEEE754 | VA |
| 功率因数 | 0x200A | IEEE754 | - |
| 频率 | 0x200E | IEEE754 | Hz |
| 有功总电能 | 0x4000 | IEEE754 | kWh |

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 👨💻 作者

**ChuwuYo**
- Email: 141227996+ChuwuYo@users.noreply.github.com
- GitHub: [@ChuwuYo](https://github.com/ChuwuYo)

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📚 相关文档

- [DDSU666电能表说明书](docs/说明书-DDSU666单相电子式电能表.pdf)
- [Modbus RTU通讯协议](docs/正泰DDSU666%20单相电能表%20RS485-MODBUS%20RTU通讯说明.pdf)
- [技术架构文档](docs/DDSU666%20上位机系统技术架构.md)
- [开发任务清单](docs/TODO.md)

---

⭐ 如果这个项目对你有帮助，请给个Star支持一下！